\clearpage
# Tables

```{r, results = "asis"}
sa4ss::table_format(
  x = model[["timeseries"]] |>
    dplyr::filter(
      Yr >= startyr
    ) |>
    dplyr::select(Year = Yr, dplyr::starts_with("retain(B):")) |>
    dplyr::mutate(
      `Total Landings` = rowSums(dplyr::across(dplyr::starts_with("retain"))),
      dplyr::across(where(is.numeric), round, 1)
    ),
  caption = "Landings (mt) by fleet and the summed coastwide total landings.",
  label = "landings",
  digits = 1,
  align = "l",
  # to do: use a renamer between fleet number and name
  col_names = c("Year", "Fixed Gear", "Trawl", "Total Landings")
)
```


```{r tab-data-strata, results = "asis"}
sa4ss::table_format(
  x = strata |>
    dplyr::select(-name) |>
    dplyr::relocate(area, .after = dplyr::last_col()),
  caption = paste(
    "The stratification used to estimate design-based indices of abundance",
    "and to expand the survey composition data."
  ),
  longtable = FALSE,
  escape = FALSE,
  label = "data-strata",
  col_names_align = "l",
  align = "r",
  col_names = c(
    "Shallow Depth",
    "Deep Depth",
    "South\\ Latitude",
    "North\\ Latitude",
    "Area (km$^2$)"
  )
)
```

\include{52tables/data-survey-n.tex}

```{r tables-likelihoods, results = "asis"}
table_likelihoods(model)
```

```{r tables-weights, results = "asis"}
dplyr::bind_rows(
  .id = "Type",
  Length = model[["Length_Comp_Fit_Summary"]],
  Age = model[["Age_Comp_Fit_Summary"]]
) |>
  dplyr::mutate(
    Fleet = recode_fleet_text(as.numeric(Fleet))
  ) |>
  dplyr::select(Type, Fleet, "Francis" = Curr_Var_Adj) |>
  dplyr::mutate(Francis = sprintf("%.2f", Francis)) |>
  kableExtra::kbl(
    escape = FALSE,
    row.names = FALSE,
    longtable = FALSE,
    booktabs = TRUE,
    label = "composition-weight",
    caption = "Data weightings applied to length and age compositions according to the `Francis' method.",
    format = "latex"
  )
```

```{r tables-retro, results = "asis"}
file_retro <- fs::dir_ls(
  dirname(model_location),
  regexp = "mohnsrho.tex",
  recurse = TRUE
)
stopifnot(length(file_retro) == 1)
sa4ss::read_child(
  fs::dir_ls(dirname(model_location), regexp = "mohnsrho.tex", recurse = TRUE)
)
```

```{r, results = "asis"}
# Yes I know this code will likely make your eye twitch... sorry
tab <- cbind(utils::read.csv(here::here("data-processed", "harvest_spex.csv")) |>
  dplyr::filter(AREA_NAME == "CW" & YEAR >= 2023 & PECIFICATION_TYPE == "OFL") |>
  dplyr::reframe(
    Year = c(YEAR, 2025:2034),
    `Adopted OFL` = c(round(VAL, 1), rep("-", 10))
  ),
  utils::read.csv(here::here("data-processed", "harvest_spex.csv")) |>
  dplyr::filter(AREA_NAME == "CW" & YEAR >= 2023 & PECIFICATION_TYPE == "ACL") |>
  dplyr::reframe(
    `Adopted ACL` = c(round(VAL, 1), rep("-", 10))
  ))
  
x <- model[["timeseries"]] |>
  dplyr::reframe(
    Year = Yr,
    ABC = round(rowSums(dplyr::across(dplyr::starts_with("dead(B)"))), 1),
    `Spawning Biomass` = round(SpawnBio, 1),
    `Fraction Unfished` = round(`Spawning Biomass`/`Spawning Biomass`[1],3)
  ) |>
  dplyr::filter(Year > endyr)

x[x$Year == 2023:2024, "ABC"] <- "-"
OFL <- round(model$derived_quants[model$derived_quants$Label %in% paste0("OFLCatch_", 2023:2034), "Value"], 1) 
OFL[1:2] <- "-"
out <- cbind(tab, OFL, x[,-1])

sa4ss::table_format(
  x = out,
  caption = "The adopted OFL (mt) and ACL (mt) and the projected OFL (mt), ABC (mt), spawning biomass, and fraction unfished for 2025-2034.",
  label = "model-projection",
  align = "l"
)
```