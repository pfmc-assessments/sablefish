## Model Structure and Assumptions

### Description of New Modeling Approaches

This section is not required for an update assessment.

### Modeling Platform and Structure

The assessment was conducted using \gls{ss3} version `r ss3_version[["current"]]` developed by Dr. Richard Methot at the \gls{noaa}, \gls{nwfsc} [@methot_stock_2013]. This most recent version was used because it included improvements and corrections not available in the previously used version of \gls{ss3}, i.e., version `r ss3_version[["previous"]]`.
Bridging between the previous and current base models is discussed in Section \@ref(model-changes-from-the-last-assessment). The R package [r4ss](https://github.com/r4ss/r4ss), version `r packageVersion("r4ss")`, was used to investigate and plot model fits.

### Model Changes from the Last Assessment

A brief list of changes that were made to the model configuration compared to the previous assessment [@Kapur:2021:SSA] are listed below.

- **Data**

  - The landings time series was both corrected and updated from the previous assessment. See Section \@ref(data) for more details on each of these changes.
    - First, landings from the Oregon Coast \gls{inpfc} area, i.e., between 42.000--46.267\textdegree N. latitude are no longer excluded from the total landings.
    - Second, landings from 1977--1982 in the catch reporting area that includes both U.S. and Canadian waters are now assigned 50--50\% to each country rather than 100\% to the U.S.
    - Third, a time series of `r spp` catches from the At-Sea Pacific Hake fishery are now included in the trawl fleet. Previous assessments have included bycatch of `r spp` from the shoreside fleet but these at-sea catches were previously only included as a sensitivity. Note that the corresponding length-composition data from this bycatch fleet was not included.
  - The index for the \gls{s-wcgbt} was updated with the most recent data using _sdmtmb_.
  - The survey length-composition data were input as either sexed or unsexed fish rather than assigning a sex to unsexed fish based on the observed sex ratio as was done in the past.

- **Fleet structure**

  - Essentially, no changes were made to the fleet structure used in the model. Benign remnants of the pot fleet, which was removed in 2019, were removed from the model files.

- **Biology**

  - No changes were made to the biological parameterization of the model.

- **Recruitment**

  - The bias adjustment ramp was updated to end with the last year of catches and begin to ramp down towards zero two years prior. Other parameters in the ramp were left as they were specified in the 2019 assessment. Note that the traditional method for estimating these parameters, which occurs external to the model, can often lead to the ramp starting years before composition data are available because of the inclusion of the environmental index.

- **Selectivity and retention**

  <!-- SizeSel_PRet_1_FIX(1)_BLK2repl_2019 -->
  - The ascending inflection for size-based retention within the fixed-gear fleet in the 2019 time block was fixed at the lower bound of 10 given that it was consistently estimated at this lower bound during the bridging analysis.
  <!-- AgeSel_P_4_TWL(2)_BLK5repl_2011 -->
  - The descending width for age-based selectivity within the trawl fleet in the 2011 time block was fixed at the upper bound of 10 given that it was consistently estimated at this upper bound during the bridging analysis.
  <!-- AgeSel_P_3_FIX(1)_BLK4repl_2011 INIT was lowered to facilitate its estimation. -->

- **Software and workflow**

  - Use a newer version of \gls{ss3}, version `r ss3_version[["current"]]`.
  - Use previously updated versions of numerous R packages related to processing input and output files for the assessment, including _nwfscDiag_, _sa4ss_, _r4ss_, and _PacFIN.Utilities_.
  - Created [_sablefish_](https::/github.com/pfmc-assessments/sablefish), an R package stored on GitHub, to provide a transparent and reproducible system for processing the data, modifying the model files, and writing these reports.

### Key Assumptions and Structural Choices

With the exceptions noted in Section \@ref(model-changes-from-the-last-assessment), the general model specifications were retained from the previous assessment to conform to the \gls{tor} for an update assessment. The assessment is sex-specific, including the estimation of separate growth curves and natural mortality parameters for males and females. The sex ratio at birth is assumed to be `r sex_ratio_text`. Female spawning biomass is used in calculating stock status.

The model starts at equilibrium, assuming an unfished initial age structure in `r startyr - 1`. The internal population dynamics include ages `r paste(sep = "--", c(age_bins[1]), model[["accuage"]])`, where age `r model[["accuage"]]` is the plus group. As there is little growth occurring at the model plus-group age and very few observations, the data use a plus-group age of `r max(age_bins)`.

The following likelihood components are included in this model: `r text_likelihoods_used(model)` (Table \@ref(tab:likelihoods)). See the \gls{ss3} technical documentation for details [@methot_stock_2013]. Estimated likelihood components from the base model can be found in the model output files archived by the \gls{pfmc}.

### Priors
 
The prior distributions for natural mortality ($M$) by sex remain the same as what was assumed in the 2019 benchmark assessment and were based on the Hamel [-@hamel_method_2015] meta-analytic approach with an assumed maximum age of 102 years for females and 98 for males. The priors assumed a log normal distributionwith a median of
`r model[["parameters"]] |> dplyr::filter(grepl("NatM", Label)) |> dplyr::pull(Prior) |> exp() |> sprintf(fmt = "%.3f") |> paste(collapse = " and ")`
yr$^{-1}$ and a standard error of
`r model[["parameters"]] |> dplyr::filter(grepl("NatM", Label)) |> dplyr::pull(Pr_SD) |> sprintf(fmt = "%.3f") |> paste(collapse = " and ")`
for females and males, respectively.

### Data Weighting

Length data from the \gls{s-wcgbt} and fishery discards, conditional age-at-length compositions from the \gls{s-wcgbt}, and marginal age compositions from the fishery fleets and other surveys were fit and appropriately weighted using an iterative approach. The Francis method (Table \@ref(tab:composition-weight)), which is based on equation TA1.8 in Francis [@francis_data_2011], was used with three iterations to tune the length and age data simultaneously. It was assumed for age-at-length data that each age was a random sample within the length bin and the model started with a sample size equal to the number of fish in that length bin. A sensitivity is included to examine the differences when data weighting of the composition data used the McAllister--Ianelli [@mcallister_bayesian_1997] method, which is based on the harmonic mean.

Extra variability parameters were estimated and added to the input variance for the indices of abundance for three surveys in the model, \gls{s-tri} both early and late, \gls{s-nslope}, and \gls{s-aslope} as well as the environmental index. Estimating additional variance for the \gls{s-wcgbt} was explored and determined to not be required.

Added variances for discard rates and mean body weights were set using values calculated iteratively using the \gls{rmse} of differences between input and estimated values derived from \gls{ss3}. Variances were parameterized in terms of standard deviation and coefficient of variation, respectively.

### Model Parameters

There were 235 estimated parameters in the base model. These included one parameter for $R_0$; 10 parameters for growth; 2 parameters for sex-specific natural mortality; 4 parameters for extra variability for the survey indices; 45 parameters for age-based selectivity, length-based retention, and time blocking of the fleets and the surveys; 163 recruitment deviations (including 30 pre-model deviations); and 10 forecast recruitment deviations which were fixed at 0 (Table \@ref(tab:parameters)).

The stock-recruitment relationship follows a Beverton--Holt parameterization with steepness was fixed at 0.70 due to the largely one-way trip nature of the time series during the period with good data collections and the high degree of confounding between equilibrium recruitment, $M$, and $h$. Likelihood profiles for $h$ in past `r spp` assessments suggest that there is little information in the data to determine $h$. The use of a fixed value under estimates the uncertainty in $MSY$ and equilibrium yield. However, the importance of this reduced uncertainty is somewhat reduced because both and $F$ and $SB_{proxy}$ are used for management rather than $MSY$.

The standard deviation of recruitment deviates remained fixed at 1.4 and was not iteratively tuned when running the model. Model results suggest that recruitment may be more variable but since 2019 the value has not been allowed to be higher than 1.4.

Maturity-at-length and length-weight parameters also remained fixed at the values that were externally estimated in 2019 and used in the 2019 benchmark assessment [@haltuch_status_2019b] (Figures \@ref(fig:maturity) and \@ref(fig:weight-at-length)). The fecundity relationship was not updated here or in 2019 and is assumed equal to female weight-at-length.

Selectivity curves remained dome shaped for all fleets within the model. The dome-shaped curves are appropriate given that older `r spp` are often found in deeper waters and may move into areas that limit their availability to fishing gear. The descending limb of dome-shaped age selectivity in the fixed gear fleet remained fixed at the value used in the 2019 benchmark assessment, which was based on the results of likelihood profiles [@haltuch_status_2019b].
