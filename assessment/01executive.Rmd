# Executive Summary{-}

## Stock{-}

This `r document_type` reports the status of `r spp` (*`r spp.sci`*) off the coast `r coast` using data through `r endyr`. The resource is modeled as a single population; however, `r spp` disperse to and from offshore seamounts; along the coastal waters of the `r coast`, Canada, and Alaska; and across the Aleutian Islands to the Western Pacific. This potential movement is not explicitly accounted for in this analysis.

## Landings and Catches{-}

The earliest landings of `r spp` off the `r coast` used within in this assessment begin in `r startyr`. The landings began to slowly increase starting in the 1910s and continued at a roughly constant level until the 1960s, where landings sharply increased (Figure \@ref(fig:es-landings)). After peaking in the late 1970s, catches slowly decreased until the 2000s when catches generally stabilized roughly between 4,000 and 6,000 mt. Since the 2019 benchmark assessment [@haltuch_status_2019b], landings have been divided among coastwide fixed-gear and trawl fleets (see Table \@ref(tab:removalsES) for the most recent ten years). Annual discard mortality by fleet is estimated within the model and informed by data from the \glsentrylong{wcgop} and other historical discarding studies. This internal estimation can result in model estimates of catches that differ between stock assessments, even when the input landings remain unchanged, due to changes in parameters, priors, or parameterizations. 

The landings in this assessment update were minimally revised and corrected from those used in the 2019 benchmark and the 2021 update assessments. First, landings from the 'Oregon Coast' \glsentrylong{inpfc} area, i.e., between 42.000--46.267\textdegree N. latitude, are no longer excluded from the total landings. Second, 1977--1982 landings from the catch reporting area that includes both U.S. and Canadian waters are now assigned equally to each country rather than 100\% to the U.S. Third, a time series of `r spp` catches from the At-Sea Pacific Hake fishery since 1990 are now included in the trawl fleet. Previous assessments have included bycatch of `r spp` from the shoreside fleet but these at-sea catches were previously only included as a sensitivity.

```{r, results = "asis"}
readLines(
  fs::path(model_location, "tables", "a_Catches_ES.tex")
) |> cat(sep = "\n")
```

```{r, results = "asis"}
sa4ss::add_figure(
  filein = fs::path(
    model_location,
    "plots",
    "catch2 landings stacked.png"
  ),
  caption = "Yearly landings (mt) for the fixed-gear (blue) and trawl (red) fleets.",
  alt_caption = "See the table of catches in the Tables section for the numeric representation of this figure.",
  label = "es-landings"
)
```

## Data and Assessment{-}

The last benchmark stock assessment for `r spp` took place in 2019 [@haltuch_status_2019b] and was followed by an update in 2021 [@Kapur:2021:SSA].  This `r document_type` uses the stock assessment framework \gls{ss3} version `r ss3_version[["current"]]`. Primary data sources include fishery landings, length compositions from discarded fish and the \glsentrylong{s-wcgbt}, and age compositions from the retained catch and fishery-independent data sources. The fishery landings were re-evaluated for this `r document_type` and extended through `r endyr`. No new age readings were conducted for the fishery collections. Data on discard rates and mean observed individual body weight of the discarded catch were updated, while new values were included in this analysis. Though, only the two most recently available years, 2020--2021, of discard rates were updated and the rest remained at the values used in the 2021 update assessment. The relative index of abundance estimated using data from the \glsentrylong{s-wcgbt}, which samples depths between 55 and 1,280 m, represents the primary source of information regarding population trends and was updated and re-analyzed to include the most recent data. Length-composition and conditional age-at-length data were also updated for this survey to include the most recent data. Other, discontinued, survey indices also contribute information on trend and demographics. Historical surveys include the `r text_survey_year_range("NWFSC.Slope")` \glsentrylong{s-nslope}, `r text_survey_year_range("AFSC.Slope")` \glsentrylong{s-aslope}, and `r text_survey_year_range("Triennial")` \glsentrylong{s-tri}. Data from the historical surveys were not re-evaluated for this `r document_type`. Additionally, an environmental time-series of sea level informs recruitment in the base model; this time-series was updated and re-analyzed using the latest tide-gauge data.

All externally estimated model parameters, weight-length relationship, maturity schedule, and fecundity relationships, remained unchanged from the 2019 benchmark assessment. As in previous assessments, growth and natural mortality were estimated using sex-specific relationships. Uncertainty in recruitment was included by estimating a full time-series of deviations from the stock--recruitment curve. The `one-way-trip' nature of the time-series does not facilitate estimation of steepness ($h$) of the stock--recruitment relationship. Therefore, $h$ was fixed at 0.7, similar to values used for other groundfish stock assessments.

## Stock Biomass and Dynamics{-}

During the first half of the 20th century it is estimated that `r spp` were exploited at relatively modest levels. Modest catches continued until the 1960s, along with a higher frequency of above average, but uncertain, estimates of recruitment through the 1970s, which led to a sharp increase in the spawning biomass during the mid-1950s to mid-1970s (Figure \@ref(fig:es-sb)). Subsequently, spawning biomass is estimated to have declined between the mid-1970s and the early 2010s, with the largest harvests occurring during the 1970s followed by harvests that were, on average, higher than pre-1970s harvest through the early 2000s. In recent years, the spawning biomass is estimated to be increasing due to strong recruitment events in 2008, 2013, 2016, 2020, and 2021 (Table \@ref(tab:ssbES)). Although the relative trend in spawning biomass is robust to uncertainty in the leading model parameters, the productivity of the stock is uncertain due to confounding of natural mortality, absolute stock size, and productivity. The estimates of uncertainty around the point estimate of spawning biomass in `r endyr+1` are large, suggesting that the spawning biomass could range from just under `r format(sb_lci, nsmall = 0, big.mark = ",", digits = 3)` mt to `r format(sb_uci, nsmall = 0, big.mark = ",", digits = 3)` mt.  

The estimated trajectory of relative spawning biomass (Figure \@ref(fig:es-sb)) across the times series is highly variable, with the population increasing to near unfished levels in the 1970s; declining to near the target relative biomass of 40\% around 2000; and then increasing at the end of the modeled period (Table \@ref(tab:ssbES) and Figure \@ref(fig:es-depl)). The estimated fraction unfished in `r endyr+1` from the base model is `r format(round(model$derived_quants[grep('Bratio_2023', model$derived_quants$Label),'Value']*100, 1), nsmall = 1)`\% (95\% interval `r round(bratio_lci*100, 1)`\%--`r round(bratio_uci*100, 1)`\%) increasing from the 2021 [@Kapur:2021:SSA] estimate of 2021 fraction unfished of 58%.

```{r, results = "asis"}
readLines(
  fs::path(model_location, "tables", "b_SSB_ES.tex")
) |> cat(sep = "\n")
```

```{r, results = "asis"}
sa4ss::add_figure(
  filein = fs::path(
    model_location,
    "plots",
    "ts7_Spawning_biomass_(mt)_with_95_asymptotic_intervals_intervals.png"
  ),
  caption = "Estimated time series of spawning biomass (open circles) and 95\\% intervals (broken lines). Spawning biomass prior to the first modelled year (filled circle) and its 95\\% intervals (horizontal lines) are also shown.",
  alt_caption = alternative_text[["time-series"]],
  label = "es-sb"
)

sa4ss::add_figure(
  filein = fs::path(
    model_location,
    "plots",
    "ts9_Relative_spawning_biomass_intervals.png"
  ),
  caption = "Estimated time series of fraction unfished in terms of spawning biomass (circles and line) and 95\\% intervals (broken lines). Horizontal, red lines at 1.0, the management target, and the minimum threshold are shown for reference.",
  alt_caption = alternative_text[["time-series"]],
  label = "es-depl"
)
```

\newpage

## Recruitment{-}

`r Spp` recruitment is estimated to have been quite variable with large amounts of uncertainty in individual recruitment events. A period of generally negative recruitment was followed by a single large recruitment event in the 1960s. This large event was followed by a period of 10 or so years of average recruitment and another large recruitment event in the late-1970s. These two large events combined with a period of more slightly positive recruitments than what was estimated for pre-1960 contributed heavily to the large increase in biomass that subsequently declined throughout much of the 1970s. Some slightly large recruitments during the mid-1980s through 1990 slowed the rate of decline, with the 1999--2001 large recruitments leading to a leveling off in the decline. The above-average cohorts from 2008, 2013, 2015, 2016, 2020, and 2021 are contributing to the current increasing trend in spawning biomass (Table \@ref(tab:recrES) and Figures \@ref(fig:es-recruits) and \@ref(fig:es-rec-devs)). The large recruitment events in 2020 and 2021 are estimated to be two of the three largest recruitment events in the modeled period (Table \@ref(tab:recrES) and Figure \@ref(fig:es-rec-devs)).

```{r results = "asis"}
readLines(
  fs::path(model_location, "tables", "c_Recr_ES.tex")
) |> cat(sep = "\n")
```

```{r, results = "asis"}
sa4ss::add_figure(
  filein = fs::path(
    model_location,
    "plots",
    "ts11_Age-0_recruits_(1000s)_with_95_asymptotic_intervals.png"
  ),
  caption = "Estimated time series of age-0 recruits (1,000s; open circles) and 95\\% intervals (whiskers). The number of recruits in the year prior to the first modelled year (filled circle) is also shown.",
  alt_caption = alternative_text[["time-series"]],
  label = "es-recruits"
)

sa4ss::add_figure(
  filein = fs::path(
    model_location,
    "plots",
    "recdevs2_withbars.png"
  ),
  caption = "Estimated time series of recruitment deviations with their 95 percent intervals. The early and recent blue dots are recruitment deviations that are not part of the main period.",
  alt_caption = alternative_text[["parameters"]],
  label = "es-rec-devs"
)
```

\newpage

## Exploitation Status{-}

Fishing intensity has been at or below the current management target of 1.0 and, on average, declining since 1988 (Table \@ref(tab:exploitES); Figure \@ref(fig:es-1-spr)). Here, fishing intensity is reported as a the ratio of one minus the \glsentrylong{spr} to one minus the \glsentryshort{spr} target of 45\%, $\frac{1-SPR}{1-SPR_{45\%}}$. Estimated exploitation for the most recent year was on par with 2015--2019 estimates but greater than the previous two years (Table \@ref(tab:exploitES)).

```{r results = "asis"}
# to do: fix the writing of d_SPR_ES.tex so we don't have to re-write the table
df <- utils::read.csv(
  fs::path(model_location, "tables", "d_SPR_ES.csv")
) |>
  dplyr::mutate(
    dplyr::across(
      dplyr::where(is.double),
      \(x) format(round(x, ifelse(x < 1, 3, 1)), big.mark = ","))
  )

df |>
  sa4ss::table_format(
    align = "r",
    col_names_align = "l",
    booktabs = TRUE,
    custom_width = TRUE,
    col_to_adjust = 2:NCOL(df),
    width = "2.1cm",
    col_names = colnames(df) |>
      gsub(pattern = ".+SPR.+SPR\\.45.", replacement = "$\\\\frac{1-SPR}{1-SPR_{45}}$") |>
      gsub(pattern = "\\.([A-Z])", replacement = " \\1") |>
      gsub(pattern = "\\.1$|\\.", replacement = ""),
    longtable = FALSE,
    escape = FALSE,
    caption = "Estimated recent trend in $\\frac{1-SPR}{1-SPR_{45\\%}}$, where SPR is the spawning potential ratio and SPR$_{45\\%}$ is the SPR management target and the exploitation rate. Lower and upper values represent 95\\% intervals of the estimates.",
    label = "exploitES"
  )
sa4ss::add_figure(
  filein = fs::path(
    model_location,
    "plots",
    "SPR3_ratiointerval.png"
  ),
  caption = "Time series of relative fishing using $\\frac{1-SPR}{1-SPR_{45\\%}}$, where SPR is the \\glsentrylong{spr} and 45\\% is the target.",
  alt_caption = alternative_text[["time-series"]],
  label = "es-1-spr"
)

```

\newpage

## Ecosystem Considerations{-}

<!-- todo Add the references in this section -->
The climate vulnerability analysis for the California Current [@McClure:2023:VCC] suggests that processes affecting `r spp` recruitment are sensitive to climatic and, therefore, oceanic drivers. Given the high climate vulnerability of `r spp`, changes in their abundance, productivity, and spatial distribution are likely, and these changes are likely to impact fishing fleets and communities because of the high value of this fishery.
Strong coastwide recruitment appears to be associated with good recruitment north of Cape Mendocino ($\sim 40^{\circ}$N), which itself is correlated with transport and temperature in the northern portion (40$^{\circ}$--48$^{\circ}$N) of the U.S. West Coast, specifically with the northern transport of yolk-sac larvae [@tolimieri_oceanographic_2018]. A re-analysis of the relationship between sea level and recruitment found that variation around the stock--recruitment curve was negatively correlated with sea level north of Cape Mendocino. Reliable sea-level data are available back to 1925, which predates the availability of composition data and thus may allow for better hindcasting of the stock dynamics relative to a model without the time series. Furthermore, information on current and future recruitment can be informed by the time series, leading to more robust estimates of estimates of uncertainty in management quantities.

`r Spp` population has experienced latitudinal shifts in the center of their distribution along the `r coast`, which has affected fishing opportunities to individual ports [@Selden:2019:CCB]. The population centroid shifted to the north between 1980 and 1992, then south by 2013. More recently, the distribution of biomass shifted north, illustrated by an increase in trawl survey biomass in the north, but not as far north as in the 1990s.

Whale entanglements with pot gear has the potential to limit effort in the pot-gear sectors due to protections for marine mammals. Estimated fleet-wide entanglements were consistently above the 5-year running-average threshold in the 2002--2017 combined Limited Entry `r spp` and Open Access Fixed-Gear pot sectors [@Hanson:2019:EHW]. This result was largely due to the Open Access Fixed-Gear pot sector, which had entanglements consistently above the threshold, while entanglements in the Limited Entry `r spp` pot sector were consistently below the threshold.

## Reference Points{-}

The estimated 2023 spawning biomass relative to unfished spawning biomass is `r round(100*model[["current_depletion"]], 2)`\%, well above the management target of 40\%. The estimated fishing intensity has been at or below the $\text{SPR}_{45\%}$ since the mid 1980s and declining, on average, in the last ten years (Figure \@ref(fig:es-phase)). Relative spawning biomass compared to fishing intensity across most years was above the thresholds (Figure \@ref(fig:es-phase)). All reference points were calculated based on a steepness value fixed at `r round(model$parameters[model$parameters$Label == "SR_BH_steep","Value"], 2)` and the estimated selectivities and catch distributions among fleets in the most recent year of the model, `r endyr` (Table \@ref(tab:referenceES)). Sustainable total yield, landings plus discards, using $\text{SPR}_{45\%}$ is `r format(model$derived_quants[model$derived_quants$Label == "Dead_Catch_SPR", "Value"], scientific = FALSE, big.mark = ",")` mt. The spawning biomass equivalent to 40\% of the unfished spawning biomass ($\text{SB}_{40\%}$) calculated using $\text{SPR}_{45\%}$ was `r format(model$derived_quants[model$derived_quants$Label == "SSB_Btgt", "Value"],  scientific = FALSE, big.mark = ",")` mt.

```{r, results = "asis"}
lines <- readLines(fs::path(model_location, "tables", "e_ReferencePoints_ES.tex")) |>
  purrr::map_chr(
    .f = \(x) gsub("& ([0-9]+)([0-9]{3})\\.", "& \\1,\\2.", x)
  ) |>
  purrr::map_chr(
    .f = \(x) gsub("centering", "raggedleft", x)
  ) |>
  purrr::map_chr(
    .f = \(x) gsub("\\\\textbackslash\\{\\}| Values", "", x)
  ) |>
  purrr::map_chr(
    .f = \(x) gsub("SB40\\\\%", "SB\\$\\_\\{40\\\\%}\\$", x)
  ) |>
  purrr::map_chr(
    .f = \(x) gsub("SPR45", "SPR\\$\\_{45\\\\%}\\$", x)
  ) |>
  purrr::map_chr(
    .f = \(x) gsub("R0", "R\\$\\_0\\$", x)
  )
cat(lines)
```

```{r, results = "asis"}
sa4ss::add_figure(
  filein = fs::path(
    model_location,
    "plots",
    "SPR4_phase.png"
  ),
  caption = "Phase plot of fraction unfished vs. relative fishing intensity, which is $\\frac{1-SPR}{1-SPR_{45\\%}}$, where SPR is \\glsentrylong{spr}. Each point represents the biomass ratio at the start of the year and the relative fishing intensity in that same year. Warmer colors (red) represent early years and colder colors (blue) represent recent years. Lines through the final point show 95% intervals based on the asymptotic uncertainty for each dimension. The shaded ellipse is a 95% region which accounts for the estimated correlation (-0.801) between the two quantities.",
  alt_caption = alternative_text[["time-series"]],
  label = "es-phase"
)

sa4ss::add_figure(
  filein = fs::path(
    model_location,
    "plots",
    "yield2_yield_curve_with_refpoints.png"
  ),
  caption = "Yield curve in terms of fraction unfished with the following reference points: maximum sustainable yield (MSY), biomass target (Btgt), spawning potential ratio (SPR), and current fraction unfished.",
  alt_caption = alternative_text[["reference-points"]],
  label = "es-yield"
)
```

\newpage

## Management Performance{-}

`r Spp` management includes a rich history of seasons, size-limits, trip-limits, and a complex permit system. Managers divide coastwide yield targets among the fleets, fishery sectors (including both limited entry and open access), as well as north and south of 36$^\circ$ N. latitude. In the most recent decade catches have been well below the overfishing limit (OFL) and annual catch limit (ACL) with attainment ranging between 53--83\% attainment of the ACL (Table \@ref(tab:es-manage)). Attainment by the fishery was lowest in 2020 and highest in 2022.


```{r, tables-management-es, results = "asis"}
# Yes I know this code will likely make your eye twitch... sorry
tab <- cbind(utils::read.csv(here::here("data-processed", "harvest_spex.csv")) |>
  dplyr::filter(AREA_NAME == "CW" & YEAR %in% c(2013:2022) & PECIFICATION_TYPE == "OFL") |>
  dplyr::reframe(
    Year = YEAR,
    OFL = round(VAL, 1)
  ),
  utils::read.csv(here::here("data-processed", "harvest_spex.csv")) |>
  dplyr::filter(AREA_NAME == "CW" & YEAR %in% c(2013:2022) & PECIFICATION_TYPE == "ACL") |>
  dplyr::reframe(
    ACL = round(VAL, 1)
  ))

ts <- model$timeseries[
  model$timeseries$Yr %in% (endyr - 9):endyr,
  c("Yr", "retain(B):_1", "retain(B):_2", "dead(B):_1", "dead(B):_2")
]
df <- data.frame(
  Landings =  ts[, "retain(B):_1"] + ts[, "retain(B):_2"],
  Catch = ts[, "dead(B):_1"] + ts[, "dead(B):_2"]
)
out <- cbind(tab, df) |>
  dplyr::mutate(dplyr::across(
    -1,
    .f = \(x) format(x, big.mark = ",")
  ))

sa4ss::table_format(
  x = out,
  caption = "The \\glsentrylong{ofl} (OFL; mt), \\glsentrylong{acl} (ACL; mt), landings (mt), and estimated catch (mt) between for the most recent ten years.",
  label = "es-manage",
  align = "l",
  col_names = c("Year", "OFL", "ACL", "Landings", "Catch")
)
```

## Unresolved Problems and Major Uncertainties{-}

```{r, echo=FALSE, results="asis"}
filein <- fs::path(here::here("assessment", "shared_text","unresolved_uncertanties.Rmd"))
sa4ss::read_child(filein)
```


## Decision Table and Projections{-}

The projection of stock biomass, status, and harvest limits was developed using the base model. The total catches in 2023 and 2024 were set at 9,118 and 8,359 mt, respectively, based on recommendations from the \glsentrylong{gmt}. The ABC values were estimated using a category 1 time-varying $\sigma_y$ starting at 0.50 combined with a P$^*$ value of 0.45. The catches during the projection period, 2025--`r max(model[["timeseries"]][["Yr"]])`, were set equal to the year-specific \glsentrylong{abc} (Table \@ref(tab:projectionES)). The spawning biomass and fraction unfished increase sharply during the projection due to the estimated large recruitments in 2020 and 2021 maturing and entering the spawning population, resulting in future \glsentrylongpl{ofl} and \glsentrylongpl{abc} that are substantially higher than those set for 2023--2024.

```{r results = "asis"}
# to do fix formatting in executive summary function
es_text <- readLines(
  fs::path(model_location, "tables", "projections.tex")
) |>
  purrr::map_chr(.f = \(x) gsub("& ([0-9]{1,3})([0-9]{3}) ", "& \\1,\\2 ", x))
cat(es_text, sep = "\n")
```

```{r results = "asis"}
# Change the label
es_text <- readLines(
  fs::path(dirname(model_location), "decision_table", "decision_table.tex")
) |>
  purrr::map_chr(.f = \(x) gsub("(tab:decision)", "\\1ES", x))
cat(es_text, sep = "\n")
```

## Scientific Uncertainty{-}

```{r, echo=FALSE, results="asis"}
filein <- fs::path(here::here("assessment", "shared_text", "scientific_uncertainty.Rmd"))
sa4ss::read_child(filein)
```

## Research and Data Needs{-}

Please refer to the 2019 benchmark assessment for a detailed list of research and data needs for `r spp` [@haltuch_status_2019b].

